<!--
 * @Author: liweilong
 * @Date: 2020-12-22 14:28:56
-->
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- common begin -->
  <link rel="stylesheet" href="__CSS__/init.min.css">
  <link rel="stylesheet" href="__CSS__/font.css">
  <link rel="stylesheet" href="__JS__/plugs/bootstrap4/css/bootstrap.min.css">
  <link rel="stylesheet" href="__CSS__/layout/header.css">
  <link rel="stylesheet" href="__CSS__/layout/footer.css">
  <!-- common end -->
  <link rel="stylesheet" href="__CSS__/onlineorder.css">
  <link rel="stylesheet" href="__JS__/plugs/jquery/jquery-ui.min.css">

  <title>在線下單</title>
</head>

<body>
    <!-- nav beigin -->
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <a class="navbar-brand" href="/index.html"><img src="__IMG__/logo.png" alt=""></a>
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
        aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
  
      <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <ul class="navbar-nav mr-auto">
         
        </ul>
        <div class="form-inline my-2 my-lg-0">
          <!-- <div class="language_wrap position-relative ">
            <div class="top_wrap d-flex justify-content-between">
              <span class="text langShow">繁體</span>
              <span class="iconfont icon-iconfontarrows1"></span>
            </div>
            <ul class="lan_ul position-absolute shadow-sm">
              <li class="lan_li">
                <a href="javascript:void(0);" class="set-lang lang_en" data-lang="en">英語</a>
              </li>
              <li class="lan_li">
                <a href="javascript:void(0);" class="set-lang lang_ch" data-lang="ch">繁體</a>
              </li> 
            </ul>
          </div> -->

          <!-- <div class="login_register justify-content-between" id="login_register" style="display: none;">
            <a href="register.html" class="register">註冊</a>
            <a href="login.html" class="login">登錄</a>
          </div>
          <div class="login_register justify-content-between" id="username_logout" style="display: none;">
            <span class="register username" id="loginName" style="width:50%;overflow: hidden;padding-left: 5px;text-overflow: ellipsis;line-height: 30px;"></span>
            <a href="javascript:void(0);" onclick="logout()" class="login">登出</a>
          </div> -->
          <div class="login_register justify-content-between" id="login_register" style="display: none;border-radius: 15px;width: 100px;border:none;">
            <a href="login.html" class="login" style="width:100%; border-radius: 15px;">登入</a>
          </div>
          <!-- logined -->
          <div class="login_register justify-content-between" id="username_logout" style="display: none;">
            <a class="logined text-decoration-none" href="/user.html"><img src="./__IMG__/info.png" style="margin-left: 5px;" alt=""/>
              <span class="username" style="overflow: hidden;padding-left: 5px;text-overflow: ellipsis;color: #000;"></span>
            </a>
            <a href="javascript:void(0);" onclick="logout()" class="login" id="logout">登出</a>
          </div>

        </div>
      </div>
  
    </nav>
  <!-- nav end -->

  <!-- display theme image begin -->
  <div class="theme_image position-relative">
    <img src="__IMG__/online_order.jpg" class="img-fluid" alt="theme image">
  </div>
  <!-- display theme image end -->

  <!-- form begin -->
  <div class="form_wrap container shadow-lg mt-4 p-5">
    <form action=""  onsubmit="return false;"  autocomplete="off" >
      <div class=" mb-form-standard row">
        <h4 class="col-md-3 col-12"><b>派送方式:</b></h4>
        <div class="col-12">
          <div class="row">
            <label for="type" class="col-form-label type col-md-3 col-12">請選擇派送方式<span class="badge  text-danger">*</span></label>
            <!-- <input type="text" name="mode" class="form-control ml-2 rounded-sm"> -->
            <div class="col-md-9 col-12">
              <div class="row ml-0 mr-0">
                <select name="type" class="form-control rounded-sm modeSelect col-12" onchange="changeWay()">
                  <option value="0">請選擇</option>
                  <option value="HOME_DELIVERY">送貨上門</option>
                  <option value="SELF_PICKUP_STATION">自提點</option>
                  <option value="SELF_SERVICE_STATION">自提櫃</option>
                </select>
              </div>
            </div>
          </div>
        </div>
        <!-- <div class="mb-form-standard col-12 mt-3">
          <div class="mr-0 row mb-3">
            <label for="homeTakeItem" class="col-form-label col-md-3 col-8">上門收件<span class="badge  text-danger">*</span></label>
            <input type="checkbox" name="isHomeTake" class="form-control rounded-sm isHomeTake col-md-1 col-2" />
          </div>
          <div class="mr-0 row homeTimeBox" style="display: none;">
            <div class="date_search col-md-6">
              <div class="row mb-3 mr-0">
                <label for="date_range" class="riqidate col-4 mb-0" style="line-height: 38px;">日期：</label>
                <input type="text" class="date_picker pl-2 col-8" name="takeDate" value=" " data-locale='{"format":"YYYY/MM/DD"}'>
              </div>
            </div>
            <div class="col-md-6">
              <div class="row mb-3 mr-0">
                <label for="send_area_id" class="col-form-label  takeProductTime col-5 col-md-4">上門收貨時間<span class="badge  text-danger">*</span></label>
                <select class="form-control rounded-sm col-7 col-md-8 regionSelect" name="takeProductTime">
                  <option>請選擇</option>
                  <option>14:00~18:00</option>
                </select>   
              </div>
            </div>
          </div>
        </div> -->
      </div>
      <div class="mb-form-standard row">
        <h4 class="col-md-3 col-12"><b>寄件人資料:</b></h4>
      </div>
      <div class=" mb-form-standard row mr-0">
        <div class=" col-12 col-md-6">
          <div class="row">
            <label for="send_name" class="col-form-label send_name col-5 col-md-3 mb-form-standard">姓名:<span class="badge  text-danger">*</span></label>
            <input type="text" name="send_name" class="form-control col-7 col-md-9 mb-form-standard">
          </div>
        </div>
        <div class=" col-12 col-md-6">
          <div class="row">
            <label for="send_phone" class="col-form-label send_phone col-12 col-md-3 mb-form-standard">聯繫電話<span class="badge  text-danger">*</span></label>
            <div class="col-4 col-md-3 flagBox form-control" tabindex="0">
              <p class="flagBlock mb-0"><a data-value="852" class="flagIcon hk" onclick="javascript:void(0);"></a><span class="code_num">+852</span><span class="arrow"></span></p>
              <div class="flagSelect">
                <ul class="flagList mb-0">
                  <li class="active" data-value="852"><a  class="flagIcon hk" onclick="javascript:void(0);"></a><span class="code_num">+852</span></li>
                  <li  data-value="86" ><a class="flagIcon cn" onclick="javascript:void(0);"></a><span class="code_num">+86</span></li>
                </ul>
              </div>
              <input class="send_phone_code phone_code" name="send_phone_code" value="852" type="hidden"/> 
            </div>
            <input type="text" name="send_phone" class="form-control col-8 col-md-6 mb-form-standard" placeholder="請輸入電話號碼" maxlength="11" onchange="checkNum(this)">
          </div>
        </div>
      </div>
      <!-- send address -->
      <div class="mb-form-standard ">
        <!-- if not take product home -->
        <div class=" row mr-0 stockAddress">
          <label for="send_area_id" class="col-form-label  send_area_id col-5 col-md-2">倉庫地址<span class="badge  text-danger">*</span></label>
          <!-- <label class="send_province col-form-label gudingdizhi">中國香港</label> -->
          
          <!-- warehouse address -->
          <select class="form-control rounded-sm col-7 col-md-10 regionSelect" name="send_address">

          </select>         
        </div>
        <!-- if take product home -->
        <div class="row mr-0 homeTakeBox" style="display: none;">
          <label for="send_area_id" class="col-form-label col-5 col-md-2 send_area_id">地址<span class="badge  text-danger">*</span></label>
          <!-- <label class="send_province col-form-label gudingdizhi col-7 col-md-2">中國香港</label> -->
          <!-- <select class="form-control rounded-sm ml-3 areaSelect" name="get_area_id">
          </select> -->
          <!-- detail address -->
          <div class="col-12 col-md-10">
            <div class="row ml-0 mr-0">
              <select class="form-control rounded-sm mb-3 col-5 regionSelect" name="send_region"  onchange="filterRegion(this)">
                <option value="0">請選擇</option>
                <option value="1">九龍</option>
                <option value="2">港島</option>
                <option value="3">新界</option>
              </select>
              <div class="col-2"></div>
              <select class="form-control rounded-sm mb-3 col-5 areaSelect" name="send_area_id">
                
              </select>
            </div>
          </div>
          <div class="col-12">
            <div class="row ml-0 mr-0">
              <input type="text" class="form-control mb-3 col-12 col-md-5"  placeholder="請填寫所在街道" name="send_street_id">
              <div class="col-1 col-md-2"></div>
              <!-- detail address -->
              <input type="text" class="form-control mb-3 col-12 col-md-5"  placeholder="請填寫所在大廈及樓層單位" name="send_building">
            </div>
          </div>
          <!-- home take time -->
          
        </div>
      </div>
      <div class="mb-form-standard row">
        <h4 class="col-md-3 col-12"><b>收件人資料:</b></h4>
      </div>
      <!-- receive people -->
      <div class="mb-form-standard mr-0 row">
          <div class=" col-12 col-md-6">
            <div class="row">
              <label for="get_name" class="col-form-label get_name col-5 col-md-3 mb-form-standard">姓名<span class="badge  text-danger">*</span></label>
              <input type="text" name="get_name" class="form-control col-7 col-md-9 mb-form-standard">
            </div>
          </div>
          <div class=" col-12 col-md-6">
            <div class="row">
              <label for="get_phone" class="col-form-label get_phone col-12 col-md-3">聯繫電話<span class="badge  text-danger">*</span></label>
              <!-- <select name="get_phone_code" class="col-md-3 col-4 form-control get_phone_code">
                <option value="852">+852</option>
                <option value="86">+86</option>
              </select> -->
              <div class="col-4 col-md-3 flagBox form-control" tabindex="0">
                <p class="flagBlock mb-0"><a data-value="852" class="flagIcon hk" onclick="javascript:void(0);"></a><span class="code_num">+852</span><span class="arrow"></span></p>
                <div class="flagSelect">
                  <ul class="flagList mb-0">
                    <li class="active" data-value="852"><a  class="flagIcon hk" onclick="javascript:void(0);"></a><span class="code_num">+852</span></li>
                    <li data-value="86"><a class="flagIcon cn" onclick="javascript:void(0);"></a><span class="code_num">+86</span></li>
                  </ul>
                </div>
                <input class="get_phone_code phone_code" name="get_phone_code" value="852" type="hidden"/> 
              </div>
              <input type="text" name="get_phone" class="form-control col-8 col-md-6" maxlength="11" placeholder="請輸入電話號碼" onchange="checkNum(this)">
            </div>
          </div>
      </div>

      <!-- mode select -->
      <div class=" mb-form-standard row pickupBox" >
        <div class="col-12">
          <div class="row">
            <div class="mb-form-standard selfieBox col-12 col-md-6">
              <div class="row mr-0">
                <label for="place" class="col-form-label place col-5 col-md-3">自提點名稱<span class="badge  text-danger">*</span></label>
                <!-- <input type="text" name="place" class="form-control ml-2 rounded-sm"> -->
                <select name="get_area_id" class="form-control rounded-sm col-7 col-md-9" onchange="selectPickup()">
                </select>
              </div>
            </div>
            <div class="mb-form-standard col-12 col-md-6 ">
              <div class="row ml-2 mr-0">
                <select name="get_pickupPoint" class="form-control rounded-sm col-12">
                    <option value="0">請選擇自提點</option>
                </select>
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- receive address -->
      <div class="mb-form-standard addressBox row"  style="display: none;">
            <label for="get_area_id" class="col-form-label col-5 col-md-2 get_area_id">地址<span class="badge  text-danger">*</span></label>
            <!-- <label class="send_province col-form-label gudingdizhi col-7 col-md-2">中國香港</label> -->
            <!-- <select class="form-control rounded-sm ml-3 areaSelect" name="get_area_id">
            </select> -->
            <!-- detail address -->
            <div class="col-12 col-md-10">
              <div class="row ml-0 mr-0">
                <select class="form-control rounded-sm mb-3 col-5 regionSelect" name="get_region"  onchange="filterRegion(this)">
                  <option value="0">請選擇</option>
                  <option value="1">九龍</option>
                  <option value="2">港島</option>
                  <option value="3">新界</option>
                </select>
                <div class="col-2"></div>
                <select class="form-control rounded-sm mb-3 col-5 areaSelect" name="get_area_id">
                  
                </select>
              </div>
            </div>
            <div class="col-12">
              <div class="row ml-0 mr-0">
                <input type="text" class="form-control mb-3 col-12 col-md-5"  placeholder="請填寫所在街道" name="get_street_id">
                <div class="col-1 col-md-2"></div>
                <!-- detail address -->
                <input type="text" class="form-control mb-3 col-12 col-md-5"  placeholder="請填寫所在大廈及樓層單位" name="get_building">
              </div>
            </div>
            <!-- <input type="text" class="form-control ml-2 get_address" name="get_address" placeholder="詳細地址" style="width: 300px;"> -->
      </div>
      <div class="mb-form-standard row">
        <h4 class="col-md-3 col-12"><b>貨物資料:</b></h4>
      </div>

      <!-- spec information -->
      <div class="mb-form-standard row">
        <h5 class="col-md-3 col-12"><b>規格資料:</b></h5>
      </div>
      <div class="row mb-form-standard">
        <div class="mb-form-standard col-12 col-md-6">
          <div class="row mr-0">
            <label for="weight" class="col-form-label  weight col-4 col-md-2">重量<span class="badge  text-danger">*</span></label>
            <input type="text" name="weight" class="form-control rounded-sm col-8 col-md-10" placeholder="kg" onchange="CalculateFee()">
          </div>
        </div>
        <div class="mb-form-standard col-12 col-md-6">
          <div class="row mr-0">
            <label for="length" class="col-form-label  col-md-2 col-3 mb-form-standard">長<span class="badge  text-danger">*</span></label>
            <input type="text" name="length" class="form-control rounded-sm col-md-2 col-3" placeholder="cm" onchange="CalculateFee()" />
            <label for="width" class="col-form-label  col-md-2 col-3">寬<span class="badge  text-danger">*</span></label>
            <input type="text" name="width" class="form-control rounded-sm col-md-2 col-3" placeholder="cm" onchange="CalculateFee()" />
            <label for="height" class="col-form-label  col-md-2 col-3">高<span class="badge  text-danger">*</span></label>
            <input type="text" name="height" class="form-control rounded-sm col-md-2 col-3" placeholder="cm" onchange="CalculateFee()" />
          </div>
        </div>
        <div class="mb-form-standard col-12">
          <div class="mr-0 row">
            <label for="volume" class="col-form-label col-md-3 col-8">包裹內是否包含電池<span class="badge  text-danger">*</span></label>
            <input type="checkbox" name="isHasBettery" class="form-control rounded-sm col-md-1 col-2" />
          </div>
        </div>
        <!-- <div class="mb-3 col-12 col-md-6">
          <div class="row">
            <label for="volume" class="col-form-label volume col-3 col-md-2">體積<span class="badge  text-danger">*</span></label>
            <input type="text" name="volume" class="form-control rounded-sm col-9 col-md-10" readonly>
          </div>
        </div> -->
      </div>
     
      <!-- goods information -->
      <div class="mb-form-standard row">
        <h5 class="col-md-3 col-12"><b>物品資料:</b></h5>
      </div>
      <div class="row">

        <div class="mb-form-standard col-12 col-md-5">
          <div class="row mr-0">
            <label for="goods" class="col-form-label goods col-4 col-md-3">名稱<span class="badge  text-danger">*</span></label>
            <input type="text" name="product_name" class="form-control rounded-sm col-8 col-md-9">
          </div>
        </div>
        <div class="mb-form-standard col-12 col-md-5">
          <div class="row mr-0">
            <label for="num" class="col-form-label num col-4 col-md-3">數量<span class="badge  text-danger">*</span></label>
            <input type="number" name="amount" class="form-control rounded-sm col-8 col-md-9" onchange="checkNum(this)">
          </div>
        </div>
        <div class="mb-form-standard col-12 col-md-2">
          <div class="row ml-3">
            <a class="addItem" id="addItem" onclick="javascript:void(0);"></a>
          </div>
        </div>
        <div class="mb-form-standard col-12 col-md-5">
          <div class="row mr-0">
            <label for="num" class="col-form-label num col-6 col-md-4 pr-0">寄託物總值<span class="badge  text-danger">*</span>$</label>
            <input type="number" name="productUnitPrice" class="form-control rounded-sm col-6 col-md-8" onchange="checkPrice(this)">
          </div>
        </div>
        <div class="elseItem col-12">
          
        </div>
        <div class="mb-form-standard col-12 col-md-5">
          <div class="row mr-0">
            <label for="price" class="col-form-label price col-4 col-md-3">運費<span class="badge  text-danger">*</span>$</label>
            <input type="text" id="Total" name="price" class="form-control rounded-sm col-8 col-md-9" value="0" readonly>
          </div>
        </div>
      </div>

      <div class="row mb-form-standard">
        <label  class="col-form-label col-12"><span class="badge  text-danger">*</span>溫馨提示：如包裹中物品種類多於一種,請點擊添加物品進行操作！</label>
      </div>

      <!-- add item and remove item -->
      <!-- <div class="button_group row justify-content-between align-items-center mb-3">
        <button onsubmit="return false;" class="col-12 col-sm-4 mt-2 d-flex justify-content-center" id="addItem">
          <div class="btn_wrap">
            添加物品
          </div>
        </button>
        <div class="col-12 col-sm-4 mt-2 d-flex justify-content-center" id="reduceItem">
          <div class="btn_wrap">
            刪除物品
          </div>
        </div>
      </div> -->

      <!-- btn group -->
      <div class="button_group row justify-content-between align-items-center button_group_order">
        <!-- <div class=" col-12 col-sm-4 mt-2 d-flex justify-content-center">
          <div class="carriage_btn btn_wrap priceCalc">
            運費試算
          </div>
        </div> -->
        <button onsubmit="return false;" class="col-12 col-sm-4 mt-2 d-flex justify-content-center submitBtn">
          <div class="btn_wrap realyBuy">
            下單
          </div>
        </button>
        <div class="col-12 col-sm-4 mt-2 d-flex justify-content-center">
          <div class="btn_wrap import_data_btn daoru">
            批量導入
          </div>
        </div>
      </div>
    </form>
    <!-- import data -->
    <input type="file" hidden class="importFile">
  </div>
  <!-- form end -->
  
  <!-- loading begin -->
  <div class="loading_wrap position-fixed">
    <div class="spinner-border text-primary loading position-absolute" role="status">
      <span class=""></span>
    </div>
  </div>
  <!-- loading end -->


 <!-- footer begin -->
 <footer class="row ml-0 mr-o p-0">
  <div class="footer_top  d-none d-sm-none d-md-block">
    <div class="bottom_nav d-flex justify-content-around align-items-center container p-0">
    </div>
  </div>
  <div class="footer_bottom d-flex justify-content-center flex-column align-items-center">
    <div class="contact">
      客服電話：+852 2353 0188 &nbsp;
      電子郵件：info@hkares.com
    </div>
    <div class="bottom_text">
      地址: 新蒲崗大有街1號 勤達中心1208室
      <!--      京公网安备 11011502003298号-->
    </div>
  </div>
</footer>
<!-- footer end -->
<!-- for download excel -->
<a style="display: none;" class="downloadResult" id="downloadResult" href="" download="result.xlsx"></a>

  <script src="__JS__/plugs/jquery/jquery.min.js"></script>
  <script src="https://cdn.staticfile.org/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
  <script src="__JS__/plugs/bootstrap4/js/bootstrap.bundle.min.js"></script>
  <script src="__JS__/common.min.js"></script>
  <script src="__JS__/plugs/layer/layer.js"></script>
  <script src="__JS__/init.js"></script>
  <script src="__JS__/plugs/jquery/jquery-ui.min.js"></script>
  <!-- websocket -->
  <script src="./__JS__/plugs/sockJs.min.js"></script>
  <script src="./__JS__/plugs/stomp.min.js"></script>

<script>
  let url = getBaseUrl();
  var listAddress=[];
  $(".loading_wrap").show();
  $.get(url + 'area/areaAll',function(res){
    // console.log(res)
    let str = ''; 
    if(is_en()){
      str+='<option value="0">please select a district</option>'
      for(i in res){
        str += '<option value="'+res[i].id+'">'+res[i].areaEn + '</option>';
      }
    }else{
      str+='<option value="0">請選擇地區</option>'
      for(i in res){
        str += '<option value="'+res[i].id+'">'+res[i].area + '</option>';
        listAddress.push({"id":res[i].id,"area":res[i].area});
      }
    }
    // console.log(str)
    $('select[name="get_area_id"]').html(str);
    $('select[name="send_area_id"]').html(str);
    $('select[name="place"]').html(str);
    $(".loading_wrap").hide();
  })

  $.get(url + 'logisticStore/logisticStoreAll',function(res){
    // console.log(res)
    let str = '';
    if(is_en()){
      str+='<option value="">please select a logistics point</option>';
      for(i in res){
        str += '<option value="'+res[i].storeAddress+'">'+res[i].storeAddress + '</option>';
      }
    }else{
      str+='<option value="">請選擇倉庫地址</option>';
      for(i in res){
        str += '<option value="'+res[i].storeAddress+'">'+res[i].storeAddress + '</option>';
      }
    }
    // console.log(str)
    $('select[name="send_address"]').html(str);
    if($.cookie("send_address")){
      $("select[name='send_address']").val($.cookie("send_address"));
    }
  })

  function filterRegion(e){
        switch ($(e).val()){
          case "0":
            $(".loading_wrap").show();
          $.get(url + 'area/areaAll',function(res){
            // console.log(res)
            let str = ''; 
            if(is_en()){
              str+='<option value="0">please select a district</option>'
              for(i in res){
                str += '<option value="'+res[i].id+'">'+res[i].areaEn + '</option>';
              }
            }else{
              str+='<option value="0">請選擇地區</option>'
              for(i in res){
                str += '<option value="'+res[i].id+'">'+res[i].area + '</option>';
                listAddress.push({"id":res[i].id,"area":res[i].area});
              }
            }
            // console.log(str)
            $('select[name="get_area_id"]').html(str);
            $('select[name="send_area_id"]').html(str);
            $('select[name="place"]').html(str);
            $(".loading_wrap").hide();
          });
          console.log(0);
          break;
          case "1":
            let str1="";
            str1+='<option value="0">請選擇地區</option>'
            str1 += '<option value="9">油尖旺區</option>';
            str1 += '<option value="8">黃大仙區</option>';
            str1 += '<option value="6">深水埗區</option>';
            str1 += '<option value="4">觀塘區</option>';
            str1 += '<option value="3">九龍城區</option>';
            $('select[name="get_area_id"]').html(str1);
          break;
          case "2":
          let str2="";
            str2+='<option value="0">請選擇地區</option>'
            str2 += '<option value="7">灣仔區</option>';
            str2 += '<option value="39">中西區</option>';
            str2 += '<option value="27">東區</option>';
            str2 += '<option value="5">南區</option>';
            $('select[name="get_area_id"]').html(str2);
            break;
          case "3":
          let str3="";
            str3+='<option value="0">請選擇地區</option>'
            str3 += '<option value="40">元朗區</option>';
            str3 += '<option value="17">荃灣區</option>';
            str3 += '<option value="16">大埔區</option>';
            str3 += '<option value="15">屯門區</option>';
            str3 += '<option value="14">沙田區</option>';
            str3 += '<option value="13">西貢區</option>';
            str3 += '<option value="11">葵青區</option>';
            str3 += '<option value="10">離島區</option>';
            str3 += '<option value="12">北區</option>';
            $('select[name="get_area_id"]').html(str3);            
            break;
          default:
            break;
        }
      }
</script>


  <script>
    if(is_en()){
      $('.gudingdizhi').text('Hong Kong, China');
      $('.priceCalc').text('Freight calculation');
      $('.realyBuy').text('Order');
      $('.daoru').text('Batch import');
      $('.send_name').html('name of sender<span class="badge  text-danger">*</span>');
      $('.send_phone').html('Sender\'s phone number<span class="badge  text-danger">*</span>');
      $('.send_area_id').html('return address<span class="badge  text-danger">*</span>');
      $('.send_address,.get_address').attr('placeholder', 'Detailed address');
      $('.get_name').html('Recipient\'s name<span class="badge  text-danger">*</span>');
      $('.get_phone').html('Recipient\'s phone number<span class="badge  text-danger">*</span>');
      $('.get_area_id').html('Address<span class="badge  text-danger">*</span>');
      $('.goods').html('goods');
      $('.num').html('Quantity');
      $('.weight').html('weight');
      $('.volume').html('volume');
      $('.mode').html('Delivery mode');
      $('.place').html('Name of pickup point');
      $('.price').html('Freight');
      
    }
    showMenu(1);
    initialHeader();
  </script>


<!-- //calculate dilivery fee -->
  <!-- main -->
  <script>
    var connectId=getRandomKey();
    var token = $.cookie('token');
    // 點擊計算運費
    $('.carriage_btn').click(function () {
      $('.loading_wrap').show()

      let weight = $('input[name="weight"]').val();
      if(weight == ''){
        layer.msg('重量為空',{icon:2,time:1500});
        $('.loading_wrap').hide();
        return false;
      }
      let num = $('input[name="num"]').val();

      let urls = getBaseUrl();

      let ds1 = $('select[name="send_area_id"]').val();
      let ds2 = $('select[name="get_area_id"]').val();

      let send_obj = {
        "areaIds1" :  ds1,
        "areaIds2" : ds2
      };
      
      $.ajax({
        type: "POST",
        url: urls + 'money/likeMoneyIds',
        data: JSON.stringify(send_obj),
        dataType: "json",
        success: function(res){
          // console.log(send_obj);
          // console.log(res);
          $('.loading_wrap').hide()
          let total_amount = 0;
          if(res.length > 0){
            if(res[0].firstWeight >= weight){
              total_amount = res[0].firstMoney * num;
              document.getElementById('#Total').value = total_amount;
              layer.alert('運費: HKD$' + res[0].firstMoney * num)
            }else{
              let pri = res[0].firstMoney + (weight - res[0].firstWeight) * res[0].money;
              total_amount = pri * num;
              document.getElementById('#Total').value = total_amount;
              layer.alert('運費: HKD$' + pri * num)
            }

          }else{
            layer.msg('暫無相應運費計算規則',{icon:2,time:1500});
          }
        },
      })
    })

    // 導入操作
    $('.import_data_btn').click(function () {
      $('.importFile').click()
    })

    $('.importFile').change(function(){
      console.log(this.files[0]);
      let checkName= this.files[0].name;
      let suffix = checkName.substr(checkName.lastIndexOf("."));
      if(this.files[0]==""){
        layer.msg("請上傳excel文件！",{icon:2,time:1000});
        $(this).val("");
        return;
      }
      if(".xls" != suffix && ".xlsx" != suffix ){    
            layer.msg("所上傳文件非excel格式的文件！",{icon:2,time:1000});
           $(this).val("");
           return;
      }
      var formData = new FormData();
      formData.append('file',this.files[0]);
      formData.append('token', token);
      formData.append('sessionId', connectId);
      //for inform customers know it's working
      let contentStr='<div class="spinner-border text-primary loading" role="status"><span class=""></span></div>';
      contentStr+='<p style="text-align:center"><span>正在導入中,請耐心等候！</span></p><p  class="detail">已上傳</p>'
      layer.open({
            type: 1,
            skin: 'layui-layer importCountdown', 
            closeBtn:0,
            area: ['320px', '215px'],
            content:contentStr,
      });
      //try connect websocket
      connect();
      // timer=setInterval(function(){
      //   $(".importCountdown .detail").text('已耗時'+time+'s!');
      //   time+=1;
      // },1000);
      
      $.ajax({
　　    url: url + 'export/readExcel',
        type: 'POST',
        cache: false,    //上传文件不需要缓存
        data: formData,
        processData: false, // 告诉jQuery不要去处理发送的数据
        contentType: false, // 告诉jQuery不要去设置Content-Type请求头
        success: function (res) {
            // console.log(res);
            // clearInterval(timer);
            layer.closeAll();
            if(res.code == 200){
                layer.msg(res.msg,{icon:1,time:1500},function(){
                  // location.href=location.href
                  let urlDownload="/result/result"+$.cookie("username")+".xlsx";
                  $(".downloadResult").attr("href",urlDownload);
                  document.getElementById("downloadResult").click();
                });
            }else{
              layer.msg(res.msg,{icon:2,time:1500})
            }
            disconnect();
            $('.importFile').val("");
        },
        error: function (err) {
            // console.log(err);
            // clearInterval(timer);
            disconnect();
            layer.closeAll();
            layer.msg('导入失败，请稍后重试！',{icon:2,time:1500});
            $('.importFile').val("");
        }
      });

      //websocket for progress bar
    })
    $(document).ready(function(){
      let token = $.cookie('token');
      if(!token){
        location.href = '/login.html';
      }
      var isSubmitFirst=true;
      $("input[name='send_name']").val($.cookie("send_name"));
      $("input[name='send_phone']").val($.cookie("send_phone"));
      $('.submitBtn').click(function(){
        let data = getData();
        let baseUrl = getBaseUrl();
        if(!data){
          return;
        }
        if(!isSubmitFirst){
          return;
        }
        $.cookie("send_name",$("input[name='send_name']").val());
        $.cookie("send_phone",$("input[name='send_phone']").val());
        $.cookie("send_address",$("select[name='send_address']").val())
        isSubmitFirst=false;
        let contentSuccess="";
        contentSuccess+='<i class="layui-layer-ico layui-layer-ico1"></i><span style="margin-left: 30px;">下單成功！</span></div><span class="layui-layer-setwin"><a class="layui-layer-ico layui-layer-close layui-layer-close1" href="javascript:;"></a></span>';
        contentSuccess+='<div class="layui-layer-btn layui-layer-btn-" style="text-align:center;"><a class="layui-layer-btn0" href="/onlineorder.html">繼續下單</a><a class="layui-layer-btn0" href="/index.html">返回首頁</a></div>'
        $.ajax({
          url:baseUrl+'order/saveOrderV2',
          data:JSON.stringify(data),
          type:'POST',
          dataType:'json',
          contentType:"application/json; charset=utf-8",
          success: function(res){
            // console.log(res)
            if(res.code == 200){
              isSubmitFirst=true;
              layer.open({
                type: 1,
                title: "信息",
                closeBtn: 0,
                shadeClose: true,
                skin: 'layui-layer-dialog',
                content:contentSuccess
              });
            }else{
              isSubmitFirst=true;
              layer.msg('下單失敗',{icon:2,time:1000})
            }
          }
        });
      });
      //add item
      $("#addItem").click(function(){
        let strForm="";
        strForm+='<div class="row items"><div class="mb-form-standard col-12 col-md-5"><div class="row mr-0"><label for="goods" class="col-form-label goods col-4 col-md-3">名稱';
        strForm+='<span class="badge  text-danger">*</span></label><input type="text" name="product_name" class="form-control rounded-sm col-8 col-md-9">';
        strForm+='</div></div><div class="mb-form-standard col-12 col-md-5"><div class="row mr-0"><label for="num" class="col-form-label num col-4 col-md-3">';
        strForm+='數量<span class="badge  text-danger">*</span></label><input type="number" name="amount" class="form-control rounded-sm col-8 col-md-9">';
        strForm+='</div></div>';
        strForm+='<div class="mb-form-standard col-12 col-md-2"><div class="row ml-3"><a class="reduceItem" id="reduceItem" onclick="removeItem(this)"></a></div></div>';
        strForm+='<div class="mb-form-standard col-12 col-md-5"><div class="row mr-0"><label for="num" class="col-form-label num col-5 col-md-4 pr-0">';
        strForm+='寄託物總值<span class="badge  text-danger">*</span>$</label><input type="number" name="productUnitPrice" class="form-control rounded-sm col-7 col-md-8" onblur="checkPrice(this)">';
        strForm+='</div></div>';
        strForm+='</div>';
        $(".elseItem").append(strForm);
      });
      //select flag show
      $(".flagBox").click(function(){
        $(this).find(".flagSelect").toggle();
      });
      //simulate select onblur effect
      $(".flagBox").blur(function(){
        $(this).find(".flagSelect").hide();
      });
      //change flag
      $(".flagList li").click(function(){
        event.stopPropagation();
        $(this).addClass("active").siblings("li").removeClass("active");
        $(this).closest(".flagSelect").hide();
        $(this).closest(".flagSelect").siblings(".phone_code").val($(this).attr("data-value"));
        $(this).closest(".flagSelect").siblings(".flagBlock").find(".code_num").text("+"+$(this).attr("data-value"));
        //switch different flag icon
        switch($(this).attr("data-value")){
          case "852":
            $(this).closest(".flagSelect").siblings(".flagBlock").find(".flagIcon").removeClass().addClass("flagIcon").addClass("hk");
            break;
          case "86":
            $(this).closest(".flagSelect").siblings(".flagBlock").find(".flagIcon").removeClass().addClass("flagIcon").addClass("cn");
            break;
          default:break;
        }
      });
      //hometake
      $(".isHomeTake").change(function(){
        if($(this).prop("checked")){
          $(".stockAddress").hide();
          $(".homeTakeBox").show();
          $(".homeTimeBox").show();
          $(".homeTimeBox select").prop("selectedIndex",0);
          $(".homeTakeBox select").prop("selectedIndex",0);
          $(".homeTimeBox input").val("");
          $(".homeTakeBox input").val("");
        }else{
          $(".stockAddress").show();
          $(".homeTakeBox").hide();
          $(".homeTimeBox").hide();
          $(".regionSelect").prop("selectedIndex",0);
        }
      })
      $('input[name="takeDate"]').datepicker({
        dateFormat:'yy-mm-dd',
      });
    });
    //remove item
      function removeItem(e){
        $(e).closest(".items").remove();
      }
      function getData()
      {
        let type=$('select[name="type"]').val();
        let isHasBettery=$('input[name="isHasBettery"]').prop("checked");
        if(isHasBettery==true){
          isHasBettery="Y";
        }else{
          isHasBettery="N";
        }
        let sendAreaId;
        let sendStreet;
        let sendBuilding;
        let sendAddress;
        let getAddress;
        let getAreaId;
        let getBuilding;
        let getStreet;
        if(type=="HOME_DELIVERY"){
          sendAreaId=$('select[name="send_area_id"]').val();
          sendStreet=$('input[name="send_street"]').val();
          sendBuilding=$('input[name="send_building"]').val();
          sendAddress=$('select[name="send_address"]').val();;
          getAreaId=$('.addressBox select[name="get_area_id"]').val();
          getBuilding=$('input[name="get_building"]').val();
          getStreet=$('input[name="get_street_id"]').val();
          getAddress=$(".addressBox select[name='get_area_id'] option:selected").text()+getStreet+getBuilding;
          // getAreaId=$(".addressBox select[name='get_area_id']").val();
        }else{
          sendAreaId=null;
          sendStreet=null;
          sendBuilding=null
          sendAddress=$('select[name="send_address"]').val();
          getStreet=null;
          getBuilding=null;
          // getAddress= $(".pickupBox select[name='get_area_id'] option:selected").text()+$(".pickupBox select[name='get_pickupPoint'] option:selected").text();
          getAddress=$(".pickupBox select[name='get_pickupPoint'] option:selected").text();
          getAreaId=$(".pickupBox select[name='get_area_id']").val();
        }
        if($("input[name='isHomeTake']").prop("checked")){
          sendStreet=$(".homeTakeBox input[name='send_street_id']").val();
          sendBuilding=$('input[name="send_building"]').val();
          sendAddress=$(".homeTakeBox select[name='send_area_id'] option:selected").text()+sendStreet+sendBuilding;
        }
        if(sendAddress==""){
          layer.msg("寄件地址不能為空！",{icon:2});
          return false;
        }
        if(getAreaId==""){
          layer.msg("收件地區不能為空",{icon:2});
          return false;
        }
        if(getAddress==""){
          layer.msg("收件地址不能為空",{icon:2});
          return false;
        }
        let product_list=[];
        let item;
        for(var i=0;i<$("input[name='product_name']").length;i++){
          item={
            "productName":$("input[name='product_name']").eq(i).val(),
            "productUnitPrice": $("input[name='productUnitPrice']").eq(i).val(),
            "currency": "HKD",
            "qty": $("input[name='amount']").eq(i).val(),
          }
          product_list.push(item);
        }

        let sender_info={
          "sendName":$('input[name="send_name"]').val(),
          "sendPhone":$('input[name=send_phone_code]').val()+$('input[name="send_phone"]').val(),
          "sendAreaId":sendAreaId,
          "sendStreet":sendStreet,
          "sendBuilding":sendBuilding,
          "sendAddress":sendAddress,
        };
        let recipient_info={
          "getName":$('input[name="get_name"]').val(),
          "getPhone":$('input[name="get_phone_code"]').val()+$('input[name="get_phone"]').val(),
          "getAreaId":getAreaId,
          "getStreet":getStreet,
          "getBuilding":getBuilding,
          "getAddress":getAddress,    
          "getPickUpPoint":$('select[name="get_pickupPoint"]').val()
        };
        let parcel_list={
          "width":$('input[name="width"]').val(),
          "length":$('input[name="length"]').val(),
          "height":$('input[name="height"]').val(),
          "weight":$('input[name="weight"]').val(),
          "volume":$('input[name="width"]').val()*$('input[name="length"]').val()*$('input[name="height"]').val(),
          "price":$('input[name="price"]').val(),
          "includeBattery": isHasBettery,
          "product_list":product_list
        };

        let token = $.cookie('token');
        if(token == ''){
          location.href = '/login.html';
        }
        if(type==null){
          layer.msg('請選擇派送方式！',{icon:2})
          return false;
        }else if(type=="HOME_DELIVERY"){
          if($(".addressBox .regionSelect")=="0"){
            layer.msg('請選擇區域！',{icon:2});
            return false;
          }
          if($(".addressBox .areaSelect").val()=="0"){
            layer.msg('請選擇地區！',{icon:2});
            return false;
          }
          if(getBuilding==""){
            layer.msg('請填寫大廈及樓層信息！',{icon:2});
            return false;
          }
          if(getStreet==""){
            layer.msg('請填寫街道信息！',{icon:2});
            return false;
          }
        }else{

        }
        if($("input[name='send_name']").val()==""){
          layer.msg('請填寫寄件人名字！',{icon:2});
          return false;
        }
        if($("input[name='send_phone']").val()==""){
          layer.msg('請填寫寄件人號碼！',{icon:2});
          return false;
        }
        if($("input[name='get_name']").val()==""){
          layer.msg('請填寫收件人名字！',{icon:2});
          return false;
        }
        if($("input[name='get_phone']").val()==""){
          layer.msg('請填寫收件人號碼！',{icon:2});
          return false;
        }
        if($('input[name=get_phone_code]').val()=="852"){
          if($("input[name='get_phone']").val().length>8){
            layer.msg('收件人電話號碼格式不正確！',{icon:2});
            return false;
          }
        }
        if($('input[name=send_phone_code]').val()=="852"){
          if($("input[name='send_phone']").val().length>8){
            layer.msg('寄件人電話號碼格式不正確！',{icon:2});
            return false;
          }
        }
        if($('select[name="get_pickupPoint"]').val()==""){
          layer.msg($('select[name="get_pickupPoint"] option:selected').text(),{icon:2});
          return false;
        }
        if($("input[name='weight']").val()==""){
          layer.msg('請填寫包裹重量！',{icon:2});
          return false;
        }
        if($("input[name='length']").val()==""){
          layer.msg('請填寫包裹長度！',{icon:2});
          return false;
        }
        if($("input[name='width']").val()==""){
          layer.msg('請填寫包裹寬度！',{icon:2});
          return false;
        }
        if($("input[name='height']").val()==""){
          layer.msg('請填寫包裹高度',{icon:2});
          return false;
        }
        for(let i=0;i<$(".goods").length;i++){
          if($("input[name='product_name']").eq(i).val()==""){
            layer.msg('請填寫物品名稱',{icon:2})
            return false;
          }
          if($("input[name='amount']").eq(i).val()==""){
            layer.msg('請填寫物品數量！',{icon:2})
            return false;
          }
        }

        return data = {
          token:token,
          type:type,
          sender_info:sender_info,
          recipient_info:recipient_info,
          parcel_list:parcel_list,
        }
      }
      
      function changeWay(){
         if($(".modeSelect").val()=="HOME_DELIVERY"){
          $(".addressBox").show();
          $('.addressBox select[name="get_region"] option:first').prop('selected',true);
          $('.addressBox select[name="get_area_id"] option:first').prop('selected',true);
          $('.addressBox input[name="get_address"]').val("");
          $(".pickupBox").hide();
          $('.selfieBox select[name="get_ares_id"] option:first').prop('selected',true);
          $('.selfieBox select[name="get_pickupPoint"] option:first').prop('selected',true);
         }else{
          //generate pickuppoint information
          selectPickup();
          $(".addressBox").hide();
          $('.addressBox select[name="get_region"] option:first').prop('selected',true);
          $('.addressBox select[name="get_area_id"] option:first').prop('selected',true);
          $('.addressBox input[name="get_address"]').val("");
          $('.selfieBox select[name="get_area_id"] option:first').prop('selected',true);
          $('.selfieBox select[name="get_pickupPoint"] option:first').prop('selected',true);
          if($(".modeSelect").val()=="SELF_PICKUP_STATION"){
            $(".pickupBox .place").text("自提點");
          }else if($(".modeSelect").val()=="SELF_SERVICE_STATION"){
            $(".pickupBox .place").text("自提櫃");
          }
          $(".pickupBox").show();
         }
      }

      function CalculateFee(){
        $('.loading_wrap').show();
        let weight = $('input[name="weight"]').val();
        let urls=getBaseUrl();
        let token = $.cookie('token');
        let width=$('input[name="width"]').val();
        let height=$('input[name="height"]').val();
        let length=$('input[name="length"]').val();
        let data={
          token:token,
          type:$("select[name='type']").val(),
          weight:weight,
          width:width,
          height:height,
          length:length,
          // pickUp:$("input[name='isHomeTake']").prop("checked"),
          pickUp:false
        };
        if(weight == ''){
          layer.msg('重量為空',{icon:2,time:1500});
          $('.loading_wrap').hide()
          return;
        }
        if(!checkFloat($('input[name="weight"]'))){
          $('input[name="weight"]').val("")
          $('.loading_wrap').hide();
          return;
        }
        if($("select[name='type']").val()==0){
          layer.msg("請選擇派送方式!",{icon:2,time:1500});
          $('input[name="weight"]').val("")
          $('.loading_wrap').hide();
          return;
        }
        //check spec format
        let reg=/^(([1-9][0-9]*)|(([0]\.\d{0,2}|[1-9][0-9]*\.\d{1,2})))$/;
        if(length==""){
          $('.loading_wrap').hide();
          return;
        }
        if(!reg.test(length)){
          $('.loading_wrap').hide();
          $('input[name="length"]').val("");
          layer.msg('長度格式不正確',{icon:2,time:1500});
          return
        }
        if(width==""){
          $('.loading_wrap').hide();
          return;
        }
        if(!reg.test(width)){
          $('.loading_wrap').hide();
          $('input[name="width"]').val("");
          layer.msg('寬度格式不正確',{icon:2,time:1500});
          return
        }
        if(height==""){
          $('.loading_wrap').hide();
          return;
        }
        if(!reg.test(height)){
          $('.loading_wrap').hide();
          $('input[name="height"]').val("");
          layer.msg('高度格式不正確',{icon:2,time:1500});
          return
        }
        if(height>=180||width>=180||length>=180||(parseFloat(height)+parseFloat(width)+parseFloat(length))>=300){
          layer.msg('貨物規格超過最大允許規格，請聯繫客服主任！');
          $('.loading_wrap').hide();
          return;
        }
        if(token=="null"||token==null){
          location.href="/login.html";
          return;
        }
        $.ajax({
          type: "GET",
          url: urls + 'money/calculateFee',
          data: data,
          dataType: "json",
          success: function(res){
            if(res.code==200){
              $('.loading_wrap').hide();
               $("input[name='price']").val(res.data);
            }else{
              $('.loading_wrap').hide();
            }
          },
          error:function(){
            $('.loading_wrap').hide();
          }
        });
      }
      
      function selectPickup(){
        let Outlets = {
          areaId : $(".pickupBox select[name='get_area_id']").val(),
          address : '',
          addressEn : '',
          type:$(".modeSelect").val()
        }
        if(Outlets.areaId=="0"){
          //SELF_PICKUP_STATION自提點，SELF_SERVICE_STATION自提櫃
          if(Outlets.type=="SELF_PICKUP_STATION"){
            $("select[name='get_pickupPoint']").html('<option value="">請選擇自提點</option>');
          }else if(Outlets.type=="SELF_SERVICE_STATION"){
            $("select[name='get_pickupPoint']").html('<option value="">請選擇自提櫃</option>');
          }
          return;      
        }
        let urls=getBaseUrl();
        $.post(url+'outlets/getOutletsLikeAll',Outlets,function(res){
          // console.log(res);
          let str;
          if(res.length<1){
            if(Outlets.type=="SELF_PICKUP_STATION"){
              layer.msg('暫無該地區的自提點，請重新選擇地區！',{icon:2,time:1500});
              $("select[name='get_pickupPoint']").html('<option value="">請選擇自提點</option>');
            }else if(Outlets.type=="SELF_SERVICE_STATION"){
              layer.msg('暫無該地區的自提櫃，請重新選擇地區！',{icon:2,time:1500});
              $("select[name='get_pickupPoint']").html('<option value="">請選擇自提櫃</option>');
            }
            return;
          }
          if(is_en()){
              str+='<option value="">please select a pickup point</option>'
              for(i in res){
                str += '<option value="'+res[i]. storeCode+'">'+res[i].addressEn+ '</option>';
              }
            }else{
              if(Outlets.type=="SELF_PICKUP_STATION"){
                str+='<option value="">請選擇自提點</option>';
              }else if(Outlets.type=="SELF_SERVICE_STATION"){
                str+='<option value="">請選擇自提櫃</option>';
              }
              for(i in res){
                str += '<option value="'+res[i].storeCode+'">'+res[i].address + '</option>';
              }
            }
            
            // console.log(str);
            $("select[name='get_pickupPoint']").html(str);
        });
      }
      var stompClient = null;

      //for websocket connection!
      function setConnected(connected) {
        console.log("successful");
      }

      function connect() {
          var socket = new SockJS(getBaseUrl()+'progressBar');
          stompClient = Stomp.over(socket);
          stompClient.connect({}, function (frame) {
              setConnected(true);
              console.log('Connected: ' + frame);
              stompClient.subscribe('/topic/progressBar'+'/'+connectId, function (res) {
              $(".importCountdown .detail").text('已上傳('+JSON.parse(res.body).current+'/'+JSON.parse(res.body).total+')');
              });
          });
      }

      function disconnect() {
          if (stompClient !== null) {
              stompClient.disconnect();
          }
          setConnected(false);
          console.log("Disconnected");
      }

      function sendName() {
        stompClient.send(getBaseUrl()+'topic/progressBar',{},formData)
      }

  </script>
</body>

</html>