<!--
 * @Author: liweilong
 * @Date: 2020-12-23 10:02:33
-->
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- common begin -->
  <link rel="stylesheet" href="__CSS__/init.min.css">
  <link rel="stylesheet" href="__CSS__/font.css">
  <link rel="stylesheet" href="__JS__/plugs/bootstrap4/css/bootstrap.min.css">
  <link rel="stylesheet" href="__CSS__/layout/header.css">
  <link rel="stylesheet" href="__CSS__/layout/footer.css">
  <!-- <link rel="stylesheet" href="__CSS__/layout/rightNav.css"> -->
  <!-- common end -->
  <link rel="stylesheet" href="__CSS__/profile.css">
  <link rel="stylesheet" href="__JS__/plugs/daterangepicker/daterangepicker.css">

    
  <link rel="stylesheet" href="__CSS__/table/jquery.datatables.min.css">
  <link rel="stylesheet" href="__CSS__/table/buttons.dataTables.min.css">

  <title>個人中心</title>
  <style>
    .container{
      padding-right: 25px;
      padding-left: 25px;
      max-width: 100% !important;
    }
  </style>
</head>

<body>
  <!-- nav beigin -->
 <nav class="navbar navbar-expand-lg navbar-dark ">
  <a class="navbar-brand" href="/index.html"><img src="__IMG__/kings_logo_transprent.svg" alt=""></a>
  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
    aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  <div class="collapse navbar-collapse" id="navbarSupportedContent">
    <ul class="navbar-nav mr-auto">
     
    </ul>
    <!-- language switcher -->
    <!-- <div class="form-inline my-2 my-lg-0">
      <div class="language_wrap position-relative ">
        <div class="top_wrap d-flex justify-content-between">
          <span class="text langShow">繁體</span>
          <span class="iconfont icon-iconfontarrows1"></span>
        </div>
        <ul class="lan_ul position-absolute shadow-sm">
          <li class="lan_li">
            <a href="javascript:void(0);" class="set-lang lang_en" data-lang="en">英語</a>
          </li>
          <li class="lan_li">
            <a href="javascript:void(0);" class="set-lang lang_ch" data-lang="ch">繁體</a>
          </li>
        </ul>
      </div> -->
<!-- 
      <div class="login_register justify-content-between" id="login_register" style="display: none;border-radius: 15px;width: 100px;border:none;">
        <a href="login.html" class="login" style="width:100%; border-radius: 15px;">登錄</a>
      </div>
      <div class="login_register justify-content-between" id="username_logout" style="display: none;">
        <a class="logined text-decoration-none" href="/user.html"><img src="https://ss0.bdstatic.com/70cFuHSh_Q1YnxGkpoWK1HF6hhy/it/u=236107512,1097719150&fm=26&gp=0.jpg" alt="">
          <span class="username" style="overflow: hidden;padding-left: 5px;text-overflow: ellipsis;"></span>
        </a>
        <a href="javascript:void(0);" onclick="logout()" class="login">登出</a>
      </div> -->
      <div class="login_register justify-content-between" id="login_register" style="display: none;border-radius: 15px;width: 100px;border:none;">
        <a href="login.html" class="login" style="width:100%; border-radius: 15px;">登入</a>
      </div>
      <!-- logined -->
      <div class="login_register justify-content-between" id="username_logout" style="display: none;">
        <a class="logined text-decoration-none" href="/user.html"><img src="./__IMG__/info.png" style="margin-left: 5px;" alt="" />
          <span class="username" style="overflow: hidden;padding-left: 5px;text-overflow: ellipsis;color: #000;"></span>
        </a>
        <a href="javascript:void(0);" onclick="logout()" class="login"  id="logout">登出</a>
      </div>

      <!-- logined -->
      <!-- <a class="logined ml-5 text-decoration-none" href="profiledetail.html">
      <img src="https://ss0.bdstatic.com/70cFuHSh_Q1YnxGkpoWK1HF6hhy/it/u=236107512,1097719150&fm=26&gp=0.jpg"
        alt="">
    </a> -->
    </div>
  </div>

</nav>
<!-- nav end -->
  <!-- body content begin -->
  <section class="mt-5 nav_section" style="padding: 0px 50px 0px 50px;">
    <nav class="container p-0">
      <div class="row ml-3 mr-3" style="overflow: auto;">
        <ul class="nav_top d-flex justify-content-between align-items-center">
          <li class="nav_top_li active" data-status="">
            <a href="javascript:void(0)" class="myOrder">我的訂單</a>
            <span class="line"></span>
          </li>|
          <li class="nav_top_li" data-status="1">
            <a href="javascript:void(0)" class="delivered">已下單</a>
            <span class="line"></span>
          </li>|
          <li class="nav_top_li" data-status="2">
            <a href="javascript:void(0)" class="toBedelivered">倉庫簽入</a>
            <span class="line"></span>
          </li>|
          <li class="nav_top_li" data-status="3">
            <a href="javascript:void(0)" class="inTransit">轉運中</a>
            <span class="line"></span>
          </li>
          |<li class="nav_top_li" data-status="4">
            <a href="javascript:void(0)" class="signedIn">派送中</a>
            <span class="line"></span>
          </li>
          |<li class="nav_top_li" data-status="5">
            <a href="javascript:void(0)" class="toBeSigned">自提件已上架</a>
            <span class="line"></span>
          </li>
          |<li class="nav_top_li" data-status="6">
            <a href="javascript:void(0)" class="signOneHalfOf">已簽收</a>
            <span class="line"></span>
          </li>|
          <li class="nav_top_li" data-status="7">
            <a href="javascript:void(0)" class="signOneHalfOf">派送異常</a>
            <span class="line"></span>
          </li>
        </ul>
      </div>
    </nav>
    

    <!-- search warp begin -->
    <div class="search_wrap container pt-4 pb-4 pl-0 pr-0 justify-content-between align-items-center">
      <div class="row ml-3 mr-3">

        <div class="name_search align-items-center col-md-7">
          <div class="row mb-3">
            <form onsubmit="return false;" class="col-12">
              <div class="input-group row ml-0">
                <input type="text" class="form_input rounded-sm pl-2 col-md-9 col-8" id="search" placeholder="賬單查詢">
                <div class="input-group-append col-md-3 col-4 pl-0 pr-0">
                  <button onsubmit="return false;" class="input-group-text btn_search"  style="width: 100%;justify-content: center;">訂單查詢</button>
                </div>
              </div>
            </form>
           
          </div>
        </div>
        <div class="date_search col-md-5">
          <div class="row mb-3 mr-0">
            <label for="date_range" class="riqidate col-md-4 col-12 mb-0" style="line-height: 38px;">上門收件日期：</label>
            <input type="text" class="date_picker pl-2 col-md-8 col-12" name="dates" value=" " data-locale='{"format":"YYYY/MM/DD"}'>
          </div>
        </div>
        <div class="batch_print_box col-12 name_search">
          <div class="row ml-0 mr-0">
            <div class="col-md-8">
              <div class="row justify-content-between btn_group">
                <div class="import_data_btn col-md-3 col-12 mb-3" id="generate-excel">
                  <span>導出訂單詳情</span>
                </div>
                <input name="file" type="file" hidden>
                <div class="col-md-3 col-12 batch_print mb-3" id="batch_print" onclick="batchPrint()" style="background-color: #1890ff;color: #fff;height: 38px;line-height: 38px;text-align: center;border-radius: .25rem;cursor: pointer;">
                  <span>批量列印快遞單</span>
                </div>
                <div class="col-md-3 col-12 trade_print mb-3" id="fragile_print" onclick="gotoFragile()" style="background-color: #1890ff;color: #fff;height: 38px;line-height: 38px;text-align: center;border-radius: .25rem;cursor: pointer;">
                  <span>列印易碎品標籤</span>
                </div>
                <div class="col-md-2 col-12 trade_print mb-3" id="trade_print" onclick="itemIndex()" style="background-color: #1890ff;color: #fff;height: 38px;line-height: 38px;text-align: center;border-radius: .25rem;cursor: pointer;">
                  <span>列印交收表</span>
                </div>
              
              </div>
            </div>
            <div class="col-md-4 col-12">
              <div class="row">
                <label for="date_range" class="riqidate col-12 mb-0" style="line-height: 38px;"><span class="badge  text-danger">*</span>溫馨提示:在選擇欄位剔上對應行即可批量列印！</label>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- date search -->
    </div>
    <!-- search warp end -->

    <!-- table content begin -->
    <div id="example_wrapper" class="dataTables_wrapper">
      <div class="table_wrap container p-0" style="min-height: 680px;overflow-x: auto;">
      <table class="table table-hover container p-0" id="orderTable" style="width: 100%;">
        <thead class="">
          <tr class="thth">
            <th style="width: 1%;min-width: 50px;"><input type="checkbox" class="select_all" onchange="selectAll(this)" style="width:24px;height:24px;vertical-align: text-bottom;" /></th>
            <th style="width: 5%;min-width:80px;">包裹號</th>
            <th style="width: 5%;min-width:80px;">運單號</th>
            <th style="width: 9%;min-width:120px;">下單時間</th>
            <th style="width: 9%;min-width:150px;">上門收件日期</th>
            <th style="width: 7%;min-width:100px;">包裹狀態</th>
            <th style="width: 2%;min-width:100px;">包裹重量</th>
            <th style="width: 2%;min-width:100px;">運費金額</th>
            <th style="width: 3%;min-width:120px;">收貨人姓名</th>
            <th style="width: 3%;min-width:120px;">收貨人電話</th>
            <th style="width: 27%;min-width:150px;">收貨地址</th>
            <th style="width: 1%;min-width:80px;text-align: center">快遞單</th>
          </tr>
        </thead>
        <tbody class="tbody" id="showOrder">
         
        </tbody>
      </table>
      </div>
    </div>


    <!-- table content end -->
    <!-- page number -->
  </section>
  <div class="card-footer clearfix" style="display: flex;align-items: center;justify-content: flex-end;">
    <ul class="pagination pagination-sm m-0" style="text-align: center;">

    </ul>
  </div>
  <!-- body content end -->
  <!-- loading begin -->
  <div class="loading_wrap position-fixed">
    <div class="spinner-border text-primary loading position-absolute" role="status">
      <span class=""></span>
    </div>
  </div>
  <!-- loading end -->
  <!-- footer begin -->
  <footer class="row ml-0 mr-0 p-0" style="margin-top:0px;">
<!--    <div class="footer_top  d-none d-sm-none d-md-block">-->
<!--      <div class="bottom_nav d-flex justify-content-around align-items-center container p-0">-->
<!--      </div>-->
<!--    </div>-->
    <div class="footer_bottom d-flex justify-content-center flex-column align-items-center">
      <div class="contact">
        客服電話：+852 2353 0188 &nbsp;
        電子郵件：info@kings-hk.com
      </div>
      <div class="bottom_text">
        地址: 新蒲崗大有街1號 勤達中心1208室
        <!--      京公网安备 11011502003298号-->
      </div>
    </div>
  </footer>
  <!-- footer end -->
  <table id="itemTable" class="itemTable" style="display: none;width: 100%;">
    <thead class="">
      <tr class="itemHead">
        <th>包裹號</th>
        <th>運單號</th>
        <th>發貨地址</th>
        <th>下單時間</th>
        <th>上門收件時間</th>
        <th>包裹狀態</th>
        <th>包裹重量</th>
        <th>運費金額</th>
        <th>收貨人姓名</th>
        <th>收貨人電話</th>
        <th>收貨地址</th>
      </tr>
    </thead>
    <tbody class="tbody" id="showItem" style="word-break: keep-all;">
     
    </tbody>
  </table>
  <!-- rightNav -->
  <!-- <div class="rightNav" id="rightNav"></div> -->
  <script src="__JS__/plugs/jquery/jquery.min.js"></script>
  <script src="__JS__/plugs/bootstrap4/js/bootstrap.bundle.min.js"></script>
  <script src="__JS__/plugs/daterangepicker/moment.min.js"></script>
  <script src="__JS__/plugs/daterangepicker/daterangepicker.js"></script>
  <script src="__JS__/common.min.js"></script>
  <script src="__JS__/plugs/layer/layer.js"></script>
  <script src="__JS__/cookie.js"></script>
  <script src="__JS__/init.js"></script>



  <script type="text/javascript" src="__JS__/table/jszip.min.js"></script>
  <script type="text/javascript" src="__JS__/table/FileSaver.js"></script>
  <script type="text/javascript" src="__JS__/table/excel-gen.js"></script>



  <script>



  </script>
<script type="text/javascript" charset="utf-8">

let token = $.cookie('token');
$.cookie("startTime",YMD(new Date()));
$.cookie("endTime",YMD(new Date()));
// console.log(token)
var Data = {
    token : token,
    orderNo : '',
    sn : '',
    status : '',
    excStartTime : YMD(new Date()),
    excEndTime : YMD(new Date()),
    pageNum : 1,
    pageSize:15
};
// for generating exported excel
var printData={
  token : token,
  orderNo : '',
  sn : '',
  status : '',
  excStartTime : '',
  excEndTime : '',
  pageNum : 1,
  pageSize:999999
};
  //global variable to save starttime and endtime
var startTime=YMD(new Date());
var endTime=YMD(new Date());

if(!$.cookie('token') || $.cookie('token') == '' || $.cookie('token') == null || $.cookie('token').length != 64){
  location.href = '/login.html';
}

// date picker
$('input[name="dates"]').daterangepicker({
  opens: 'center'
}, function (start, end, label) {
  // console.log("选择了一个新的日期: " + start.format('YYYY-MM-DD') + ' to ' + end.format('YYYY-MM-DD'));
  Data.excStartTime = start.format('YYYY-MM-DD')
  Data.excEndTime = end.format('YYYY-MM-DD')
  // save startTime and endTime
  startTime=start.format('YYYY-MM-DD');
  endTime=end.format('YYYY-MM-DD');
  $.cookie("startTime",start.format('YYYY-MM-DD'));
  $.cookie("endTime",end.format('YYYY-MM-DD'));
  localStorage.setItem("startTime",start.format('YYYY-MM-DD'));
  localStorage.setItem("endTime",end.format('YYYY-MM-DD'));
  printData.excStartTime=start.format('YYYY-MM-DD');
  printData.excEndTime=end.format('YYYY-MM-DD');
  getOrderList()
});

function jump(i=0){   
    if(i != 0){
        Data.pageNum = i;
    }
    getOrderList();
  }
function getOrderList()
{
 let url = getBaseUrl();
 $(".select_all").prop("checked",false);
 $('.loading_wrap').show();
    $.post(url + 'order/likeOrderUserById',Data,function(res){
        // console.log(res);
        Data.pageNum = res.pageNum;
        Data.lastPage = res.pages;
        Data.isLastPage = res.isLastPage;
        Data.isFirstPage = res.isFirstPage;
        Data.nextPage = res.nextPage;
        Data.prePage = res.prePage;
        let list = res.list;
        let str = '';
        if(is_en()){
          for(i in list){
              str += '<li class="kd-clearfix clearfix"><div class="newslist-title float-left"><a href="/detail.html?id='+list[i].id+'" target="_blank">'+list[i].titleEn+'</a></div><div class="newslist-time float-right"><span class="newslist-time-auth"></span><span class="newslist-time-date">'+YMD(list[i].time)+'</span></div></li>';
          }
        }else{
          for(i in list){
              str += '<li class="kd-clearfix clearfix"><div class="newslist-title float-left"><a href="/detail.html?id='+list[i].id+'" target="_blank">'+list[i].title+'</a></div><div class="newslist-time float-right"><span class="newslist-time-auth"></span><span class="newslist-time-date">'+YMD(list[i].time)+'</span></div></li>';
          }
        }
        $('.loading_wrap').hide();
        $('.newslist_ul').html(str);

        // 分页
        //if list is emoty,don't generate pagination
        if(list.length>=1){
          let pagestr = '<li class="page-item  page-block"><a class="page-link prev" href="javascript:void(0)">«</a></li>';
          
          if(res.pageNum>=30){
            pagestr+='<li class="page-item  page-block"><a class="page-link" href="javascript:void(0)" onclick="jump('+1+')">...</a></li>';
          }
          for(let i = 1; i <= res.pages; i++){  
              if(res.pageNum == i){
                  pagestr += '<li class="page-item active page-block"><a class="page-link" href="javascript:void(0)" onclick="jump('+i+');">'+i+'</a></li>';
              }else{
                if(res.pages<30){
                  pagestr += '<li class="page-item page-block"><a class="page-link" onclick="jump('+i+');" href="javascript:void(0)">'+i+'</a></li>'
                }else{
                  //when page count >30
                  if(i<(Math.min(res.pageNum+30,res.pages)) && i>res.pageNum){
                    pagestr += '<li class="page-item page-block"><a class="page-link" onclick="jump('+i+');" href="javascript:void(0)">'+i+'</a></li>'
                  }
                }
              }
          }

          if(res.pageNum>=30){
            pagestr+='<li class="page-item page-block"><a class="page-link" href="javascript:void(0)" onclick="jump('+res.pages+')">...</a></li>';
          }
          pagestr += '<li class="page-item page-block"><a class="page-link next" href="javascript:void(0)">»</a></li>';
          $('.pagination-sm').html(pagestr)
        }else{
          $('.pagination-sm').html('');
        }




        let html = '';
        for(i in list){
            let status = ''; 
            if(is_en()){
                switch(list[i].status){
                    case "1" :
                        status = 'Ordered';
                        break;
                    case "2" :
                        status = 'In stock'
                        break;
                    case "3" :
                        status = 'Out stock'
                        break;
                    case "4" :
                        status = 'Delivering'
                        break;
                    case "5" :
                        status = 'On Shelf'
                        break;
                    case "6" :
                        status = 'Signed'
                    case "7" :
                    status = 'Overtime'
                        break;
                }
                
            }else{
                        switch(list[i].status){
                    case "1" :
                        status = '已下單';
                        break;
                    case "2" :
                        status = '倉庫簽入'
                        break;
                    case "3" :
                        status = '轉運中'
                        break;
                    case "4" :
                        status = '派送中'
                        break;
                    case "5" :
                        status = '自提件已上架'
                        break;
                    case "6" :
                        status = '已簽收'
                        break;
                    case "7" :
                        status= '派送異常';
                        break;
                    default:break;

                }
            }
            html += '<tr class="upperTr" onclick="toggleTable(this)" data-orderNo="'+list[i].orderNo+'" data-show="false">'
            html += '<td onclick="event.stopPropagation();"><input name="isPrint" class="isPrint" type="checkbox" style="width:24px;height:24px;"></td>' ;
            html += '<td onclick="event.stopPropagation();">'+list[i].orderNo+"</td><td>"+list[i].waybillNo+'</td><td>'+list[i].sendTime+'</td><td>'+newYMD(list[i].pickupDate)+'</td><td>'+status+'</td><td>'+list[i].weight+'kg</td><td>$'+list[i].price+'</td><td>'+list[i].getName+'</td><td>'+list[i].getPhone+'</td><td>'+list[i].getAddress+'</td><td style="text-align: center"><a href="javascript:void(0);"  data-orderNo="'+list[i].orderNo+ '" onclick="printWayBill(this)">列印</a></td>'
            html += '</tr>' ;
            // html+='<tr class="childTr" data-show="false""><td colspan="9" class="childTd"><div class="tableDetail" style="display:none;"><table style="margin:auto auto;" width="100%"><tr><td>種類</td><td>數量</td></tr>';
            // html+='<tbody><tr><td width="50%">type</td><td width="50%">20</td</tr></tbody>';
            // html+='</table></div></td></tr>';
            html+='<tr class="childTr" data-show="false"></tr>';
          }
        $('#showOrder').html(html);
        btnShow();
    });
}
    getOrderList();

    $('.nav_top_li').click(function(){
        $('.nav_top_li').removeClass('active');
        $(this).addClass('active');
        let status = $(this).attr('data-status');
        // console.log(status)
        Data.status = status;
        printData.status=status;
        getOrderList();
    })
    $('.btn_search').click(function(){
        let search = $('#search').val();
        if(search!=""){
          Data.excEndTime="";
          Data.excStartTime="";
        }else{
          Data.excEndTime=endTime;
          Data.excStartTime=startTime;
        }
        Data.orderNo = search;
        Data.status = '';
        getOrderList();
    })
function btnShow(){
  $('.prev').click(function(){
        if(Data.isFirstPage){
            return false;
        }
        Data.pageNum = Data.prePage;
        jump();
    })
    $('.next').click(function(){
        if(Data.isLastPage){
            return false;
        }
        Data.pageNum = Data.nextPage;
        jump()
    })
}
function printWayBill(e){
  let token=$.cookie("token");
  let baseUrl = getBaseUrl();
  let orderNo=[];
  orderNo.push($(e).attr("data-orderNo"))
  let data={token:token,orderNo:orderNo};
  event.stopPropagation();
  $.ajax({
    url:baseUrl+'order/getOrderByOrderNoAndToken',
    data:JSON.stringify(data),
    type:'POST',
    dataType:'json',
    contentType:"application/json; charset=utf-8",
    success: function(res){
      // console.log(res)
      let printUrl="/waybill/waybill_pickup.html";
      if(res.code == 200){
        let arrayOrder=[];
        let item;
        item={
          "getName":res.data[0].getName,
          "getPhone":res.data[0].getPhone,
          "getAddress":res.data[0].getAddress,
          "getPickUpPoint":res.data[0].getPickUpPoint,
          "type":res.data[0].type,
          "getAreaId":res.data[0].getAreaId,
          "price":res.data[0].price,
          "weight":res.data[0].weight,
          "length":res.data[0].length,
          "width":res.data[0].width,
          "height":res.data[0].height,
          "sendTime":res.data[0].sendTime,
          "barcode":res.data[0].waybillNo,
          "orderNo":res.data[0].orderNo,
          "remarks":res.data[0].remarks
        };
        arrayOrder.push(item);
        arrayOrder=JSON.stringify(arrayOrder);
        localStorage.setItem("arrayOrder",arrayOrder);
        if($.cookie("username").includes("lalamove")){
              window.open("/waybill/lalamovewaybill_pickup.html",'_blank');
        }else{
          window.open("/waybill/waybill_pickup.html",'_blank');
        }
      }else{
        layer.msg('查詢失敗',{icon:2,time:1000});
      }
    }
  });
}
function toggleTable(e){
  let token=$.cookie("token");
  let baseUrl = getBaseUrl();

  for(let i=0;i<$(".upperTr").length;i++){
    if($(".upperTr").eq(i).attr("data-show")==$(e).attr("data-show")){
      continue ;
    }
    $(".upperTr").eq(i).next().find(".tableDetail").slideUp();
    $(".upperTr").eq(i).attr("data-show","false");
  }
  if($(e).attr("data-show")=="false"){
    $(".loading_wrap ").show();
    let data={token:token,orderNo:$(e).attr("data-orderNo")};
    $.ajax({  
      url:baseUrl+'productList/getProductListByOrderNo',
      data:data,
      type:'GET',
      dataType:'json',
      contentType:"application/json; charset=utf-8",
      success: function(res){
        if(res.code==200){
          let htmlStr='<td colspan="999" class="childTd"><div class="tableDetail" style="display:none;"><table style="margin:auto auto;" width="100%">';
          htmlStr+='<thead><tr><td>名稱</td><td>數量</td><td>單價</td></tr></thead><tbody>';
          let data=res.data;
          for(var i=0;i<data.length;i++){
            htmlStr+='<tr><td width="33.3%">'+data[i].productName+'</td><td width="33.3%">'+data[i].qty+'</td><td width="33.3%">'+data[i].productUnitPrice+'</td></tr>';
          }
          htmlStr+='</tbody></table></div></td>'
          $(".loading_wrap ").hide();
          $(e).next().html(htmlStr);
          $(e).attr("data-show","true");
          $(e).next().find(".tableDetail").slideDown();
        }else{
          layer.msg('查詢失敗',{icon:2,time:1000});
        }
      }
    });
  }else{
    $(e).attr("data-show","false");
    $(e).next().find(".tableDetail").slideUp();
  }
}


//select all waybill to print
function selectAll(e){
  if($(e).prop("checked")){
    $(".isPrint").prop("checked",true);
  }else{
    $(".isPrint").prop("checked",false);
  }
}
// jump()
//remember time
function itemIndex(){
  window.open("/itemList/index.html",'_blank');
}
//batch print
function batchPrint(){
  let orderList=[];
       for(let i=0;i<$(".isPrint").length;i++){
        if($(".isPrint").eq(i).prop("checked")){
         orderList.push($(".isPrint").eq(i).closest(".upperTr").attr("data-orderno"));
        }
       }
       if(orderList.length<1){
         layer.msg("至少勾選一項才能執行該功能",{icon:2,time:1000});
         return;
       }
       let token=$.cookie("token");
       let baseUrl=getBaseUrl();
       let data={token:token,orderNo:orderList};
       $.ajax({
        url:baseUrl+'order/getOrderByOrderNoAndToken',
        data:JSON.stringify(data),
        type:'POST',
        dataType:'json',
        contentType:"application/json;charset=utf-8",
        success: function(res){
          // console.log(res)
          if(res.code == 200){
            let arrayOrder=[];
            let item;
            for(let i=0;i<res.data.length;i++){
              item={
                "getName":res.data[i].getName,
                "getPhone":res.data[i].getPhone,
                "getAddress":res.data[i].getAddress,
                "getPickUpPoint":res.data[i].getPickUpPoint,
                "type":res.data[i].type,
                "getAreaId":res.data[i].getAreaId,
                "price":res.data[i].price,
                "weight":res.data[i].weight,
                "length":res.data[0].length,
                "width":res.data[0].width,
                "height":res.data[0].height,
                "sendTime":res.data[i].sendTime,
                "barcode":res.data[i].waybillNo,
                "orderNo":res.data[i].orderNo,
                "remarks":res.data[i].remarks
              };
              arrayOrder.push(item);
            }
            arrayOrder=JSON.stringify(arrayOrder);
            localStorage.setItem("arrayOrder",arrayOrder);
            window.open("/waybill/waybill_pickup.html",'_blank');

            // if($.cookie("username").includes("lalamove")){
            //   window.open("/waybill/lalamovewaybill_pickup.html",'_blank');
            // }else{
            //   window.open("/waybill/waybill_pickup.html",'_blank');
            // }
          }else{
            layer.msg('查詢失敗',{icon:2,time:1000});
          }
        }
      });
}

//fragile print
function gotoFragile(){
  window.open('/waybill/fragile.html','_blank ');
}
</script>
<script>
  if(is_en()){
    $('.myOrder').text('My order');
    $('.delivered').text('Delivered');
    $('.toBedelivered').text('To be delivered');
    $('.inTransit').text('In transit');
    $('.signedIn').text('Signed in');
    $('.toBeSigned').text('To be signed');
    $('.signOneHalfOf').text('Sign on behalf of');
    
    $('#search').attr('placeholder', 'Bill inquiry');
    $('.btn_search').text('Bill inquiry');
    $('.import_data_btn').text('Export');
    $('.riqidate').text('Date:');
    $('.thth').html('<th>Package number</th><th>Delivery time</th><th>Package status</th><th>Package weight</th><th>Freight amount</th><th>Name of consignee</th><th>Receiver\'s telephone number</th><th>Receiving address</th>');


  }
  $(document).ready(function(){

    //export excel 
        $("#generate-excel").off("click").on("click",function(){
          let itemHtml='';
          if(printData.excStartTime==""||printData.excEndTime==""){
            printData.excStartTime=YMD(new Date());
            printData.excEndTime=YMD(new Date());
          }
          $(".loading_wrap").show();
          $.post(getBaseUrl() + 'order/likeOrderUserById',printData,function(res){
            let list=res.list;
            for(let i=0;i<list.length;i++){
              if(is_en()){
                switch(list[i].status){
                    case "1" :
                        status = 'Ordered';
                        break;
                    case "2" :
                        status = 'In stock'
                        break;
                    case "3" :
                        status = 'Out stock'
                        break;
                    case "4" :
                        status = 'Delivering'
                        break;
                    case "5" :
                        status = 'On Shelf'
                        break;
                    case "6" :
                        status = 'Signed'
                    case "7" :
                    status = 'Overtime'
                        break;
                }}else{
                      
                  switch(list[i].status){
                        case "1" :
                            status = '已下單';
                            break;
                        case "2" :
                            status = '倉庫簽入'
                            break;
                        case "3" :
                            status = '轉運中'
                            break;
                        case "4" :
                            status = '派送中'
                            break;
                        case "5" :
                            status = '自提件已上架'
                            break;
                        case "6" :
                            status = '已簽收'
                            break;
                        case "7" :
                            status= '派送異常';
                            break;
                        default:break;
                    }
                }

              itemHtml+= ' <tr class="upperTr"><td>'+list[i].orderNo+'</td><td>'+list[i].waybillNo+'</td><td>'+list[i].sendAddress+'</td>';
              itemHtml+='<td>'+list[i].sendTime+'</td><td>'+newYMD(list[i].pickupDate)+'</td><td>'+status+'</td><td>'+list[i].weight+'</td><td>$'+list[i].price+'</td><td>'+list[i].getName+'</td><td>'+list[i].getPhone+'</td><td>'+list[i].getAddress+'</td>' ;
              for(let index=0;index<list[i].product_list.length;index++){
                if(list[i].product_list.length>$(".itemName").length){
                  $(".itemHead").append("<th class='itemName'>物品名稱</th><th>數量</th><th>單價</th>")
                }
                itemHtml+="<td>"+list[i].product_list[index].productName+"</td><td>"+list[i].product_list[index].qty+"</td><td>"+list[i].product_list[index].productUnitPrice+"</td>";
              }
            itemHtml+='</tr>';
            } 
            $('#showItem').html(itemHtml); 
            let excel = new ExcelGen({
              "src_id": "itemTable",
              "show_header": true
            });
            $(".loading_wrap").hide();
            excel.generate();
          });
        });
      //渲染菜单
      showMenu(3);
      initialHeader();
      // $.get('rightNav.html',(data)=>{
      //   $('#rightNav').html(data);
      // });
  });


</script>
</body>

</html>